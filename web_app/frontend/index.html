<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ·å‹å›¾3Dæ¨¡å‹è½¬æ¢ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8ebff;
            transform: scale(1.02);
        }

        .upload-area svg {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .upload-area p {
            color: #666;
            margin: 10px 0;
        }

        .upload-area .hint {
            font-size: 0.9em;
            color: #999;
        }

        input[type="file"] {
            display: none;
        }

        /* é¢„è§ˆåŒºåŸŸ */
        .preview-area {
            text-align: center;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9ff;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-area img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .preview-area.empty {
            color: #999;
        }

        /* å‚æ•°è°ƒæ•´ */
        .parameters {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .parameter-item {
            margin-bottom: 20px;
        }

        .parameter-item label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .parameter-item input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .parameter-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4);
        }

        .parameter-item input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(102, 126, 234, 0.4);
        }

        .parameter-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* æŒ‰é’® */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* 3DæŸ¥çœ‹å™¨ */
        #canvas3d {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            background: linear-gradient(180deg, #e0e7ff 0%, #f3e7e9 100%);
        }

        /* çŠ¶æ€æç¤º */
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status.loading {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stats-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .stats-item strong {
            color: #667eea;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0;
            }

            .card {
                padding: 15px;
            }

            .button-group {
                flex-direction: column;
            }

            #canvas3d {
                height: 300px;
            }
        }

        /* æ¨¡å‹ä¿¡æ¯ */
        .model-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            color: #856404;
        }

        .download-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            display: inline-block;
            margin-top: 10px;
        }

        .download-btn:hover {
            box-shadow: 0 8px 15px rgba(17, 153, 142, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ  æˆ·å‹å›¾3Dæ¨¡å‹è½¬æ¢ç³»ç»Ÿ</h1>
            <p>å°†2Dæˆ·å‹å›¾å¿«é€Ÿè½¬æ¢ä¸ºäº¤äº’å¼3Dæ¨¡å‹</p>
        </header>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šä¸Šä¼ å’Œå‚æ•° -->
            <div>
                <div class="card">
                    <h2>ğŸ“¤ ä¸Šä¼ æˆ·å‹å›¾</h2>
                    
                    <div class="upload-area" id="uploadArea">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p style="font-weight: 600;">ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½æ–‡ä»¶</p>
                        <p class="hint">æ”¯æŒ PNG, JPG, JPEG, BMP</p>
                        <p class="hint">æœ€å¤§ 50MB</p>
                    </div>

                    <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.bmp">

                    <div class="status" id="uploadStatus"></div>

                    <h2 style="margin-top: 30px;">ğŸ›ï¸ å‚æ•°è°ƒæ•´</h2>
                    <div class="parameters">
                        <div class="parameter-item">
                            <label>
                                æ£€æµ‹ç½®ä¿¡åº¦
                                <span class="parameter-value" id="confValue">0.30</span>
                            </label>
                            <input type="range" id="confidence" min="0.1" max="0.9" step="0.05" value="0.3">
                            <div class="hint" style="margin-top: 5px;">
                                è¶Šä½æ£€æµ‹æ›´å¤šæˆ¿é—´ï¼Œä½†å¯èƒ½è¯¯æ£€ï¼›è¶Šé«˜æ£€æµ‹æ›´ç²¾å‡†ä½†å¯èƒ½æ¼æ£€
                            </div>
                        </div>

                        <div class="parameter-item">
                            <label>
                                æ¯”ä¾‹å°º (å˜ç±³/åƒç´ )
                                <span class="parameter-value" id="scaleValue">2.00</span>
                            </label>
                            <input type="range" id="scale" min="1.0" max="5.0" step="0.5" value="2.0">
                            <div class="hint" style="margin-top: 5px;">
                                ç”¨äºå‡†ç¡®è®¡ç®—æˆ¿é—´å®é™…å°ºå¯¸
                            </div>
                        </div>

                        <div class="parameter-item">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="straighten" checked style="width: 18px; height: 18px; margin-right: 8px;">
                                <span>å¯ç”¨æ›¼å“ˆé¡¿å‡è®¾ï¼ˆå¼ºåˆ¶æ°´å¹³/å‚ç›´å¢™ä½“ï¼‰</span>
                            </label>
                            <div class="hint" style="margin-top: 5px;">
                                âœ¨ è‡ªåŠ¨è°ƒæ•´è½»å¾®åå·®çš„å¢™ä½“ä¸ºå®Œå…¨æ°´å¹³æˆ–å‚ç›´ï¼Œä½¿æˆ¿é—´æ›´è§„åˆ™
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" id="generateBtn" disabled>
                            âš¡ ç”Ÿæˆ3Dæ¨¡å‹
                        </button>
                        <button class="btn-secondary" id="resetBtn">é‡ç½®</button>
                    </div>

                    <div class="status" id="processStatus"></div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šé¢„è§ˆå’Œ3Dæ˜¾ç¤º -->
            <div>
                <div class="card">
                    <h2>ğŸ‘€ å›¾åƒé¢„è§ˆ</h2>
                    <div class="preview-area empty" id="previewArea">
                        <p>ä¸Šä¼ å›¾åƒåå°†æ˜¾ç¤ºé¢„è§ˆ</p>
                    </div>

                    <h2 style="margin-top: 30px;">ğŸ¯ 3Dæ¨¡å‹æŸ¥çœ‹</h2>
                    <div id="canvas3d"></div>
                    <div class="stats" id="statsArea" style="display: none;">
                        <div class="stats-item">
                            <strong>æˆ¿é—´æ•°ï¼š</strong>
                            <span id="geometryCount">0</span>
                        </div>
                        <div class="stats-item">
                            <strong>å®½åº¦ï¼š</strong>
                            <span id="modelWidth">0</span>m
                        </div>
                        <div class="stats-item">
                            <strong>æ·±åº¦ï¼š</strong>
                            <span id="modelDepth">0</span>m
                        </div>
                        <div class="stats-item">
                            <strong>é«˜åº¦ï¼š</strong>
                            <span id="modelHeight">0</span>m
                        </div>
                        <br>
                        <button class="btn-primary download-btn" id="downloadBtn" style="width: auto;">
                            â¬‡ï¸ ä¸‹è½½GLBæ–‡ä»¶
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const API_BASE = 'http://localhost:5000/api';
        let currentFilename = null;
        let currentModel = null;
        let scene3d = null;
        let renderer = null;
        let modelUrl = null;

        // åˆå§‹åŒ–Three.js
        function init3DViewer() {
            const canvas3d = document.getElementById('canvas3d');
            const width = canvas3d.clientWidth;
            const height = canvas3d.clientHeight;

            scene3d = new THREE.Scene();
            scene3d.background = new THREE.Color(0xf5f5f5);

            const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.set(10, 10, 10);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            canvas3d.appendChild(renderer.domElement);

            // æ·»åŠ å…‰æº
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene3d.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 10);
            scene3d.add(directionalLight);

            // æ·»åŠ ç½‘æ ¼
            const gridHelper = new THREE.GridHelper(50, 50, 0xcccccc, 0xeeeeee);
            scene3d.add(gridHelper);

            // æ·»åŠ åæ ‡è½´
            const axesHelper = new THREE.AxesHelper(5);
            scene3d.add(axesHelper);

            // æ§åˆ¶å™¨
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.autoRotate = true;
            controls.autoRotateSpeed = 5;
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // åŠ¨ç”»å¾ªç¯
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene3d, camera);
            }

            animate();

            // å“åº”çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', () => {
                const newWidth = canvas3d.clientWidth;
                const newHeight = canvas3d.clientHeight;
                camera.aspect = newWidth / newHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(newWidth, newHeight);
            });
        }

        // åŠ è½½3Dæ¨¡å‹
        function load3DModel(modelUrl) {
            if (!scene3d) {
                init3DViewer();
            }

            // æ£€æŸ¥GLTFLoaderæ˜¯å¦åŠ è½½
            if (typeof THREE === 'undefined' || typeof THREE.GLTFLoader === 'undefined') {
                console.error('âŒ GLTFLoader è¿˜æœªåŠ è½½');
                showStatus('error', 'âŒ 3Dåº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                return;
            }

            const loader = new THREE.GLTFLoader();
            loader.load(modelUrl, (gltf) => {
                // ç§»é™¤æ—§æ¨¡å‹
                if (currentModel) {
                    scene3d.remove(currentModel);
                }

                currentModel = gltf.scene;
                scene3d.add(currentModel);

                // è‡ªåŠ¨å±…ä¸­å’Œç¼©æ”¾
                const box = new THREE.Box3().setFromObject(currentModel);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());

                currentModel.position.sub(center);

                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = 75;
                let cameraZ = Math.abs(maxDim / 2 / Math.tan((fov * Math.PI) / 360));
                cameraZ *= 1.5;

                const camera = new THREE.PerspectiveCamera(
                    fov,
                    scene3d.children[0].aspect || 1,
                    0.1,
                    1000
                );
                camera.position.z = cameraZ;

                showStatus('success', 'âœ… 3Dæ¨¡å‹åŠ è½½æˆåŠŸ');
            }, undefined, (error) => {
                console.error('æ¨¡å‹åŠ è½½å¤±è´¥:', error);
                showStatus('error', 'âŒ 3Dæ¨¡å‹åŠ è½½å¤±è´¥');
            });
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(type, message, duration = 5000) {
            const statusEl = document.getElementById('processStatus');
            statusEl.className = `status show ${type}`;
            statusEl.textContent = message;

            if (type !== 'loading') {
                setTimeout(() => {
                    statusEl.classList.remove('show');
                }, duration);
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.getElementById('uploadArea').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        // æ‹–æ‹½ä¸Šä¼ 
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        async function handleFileSelect(file) {
            showStatus('loading', 'ğŸ“¤ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...');

            const formData = new FormData();
            formData.append('file', file);

            try {
                console.log('ä¸Šä¼ æ–‡ä»¶åˆ°:', `${API_BASE}/upload`);
                console.log('æ–‡ä»¶ä¿¡æ¯:', { name: file.name, size: file.size, type: file.type });

                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData
                });

                console.log('å“åº”çŠ¶æ€:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('ä¸Šä¼ ç»“æœ:', result);

                if (result.status === 'success') {
                    currentFilename = result.filename;
                    showStatus('success', 'âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');

                    // æ˜¾ç¤ºé¢„è§ˆ
                    const previewArea = document.getElementById('previewArea');
                    previewArea.innerHTML = `<img src="${API_BASE}/preview/${currentFilename}">`;
                    previewArea.classList.remove('empty');

                    // å¯ç”¨ç”ŸæˆæŒ‰é’®
                    document.getElementById('generateBtn').disabled = false;
                } else {
                    showStatus('error', `âŒ ${result.message}`);
                }
            } catch (error) {
                console.error('ä¸Šä¼ é”™è¯¯è¯¦æƒ…:', error);
                showStatus('error', `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}\n\nğŸ’¡ è¯·ç¡®ä¿:\n1. åç«¯æœåŠ¡åœ¨è¿è¡Œ (ç«¯å£5000)\n2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°(F12)æŸ¥çœ‹è¯¦ç»†é”™è¯¯`);
            }
        }

        // å‚æ•°å®æ—¶æ›´æ–°
        document.getElementById('confidence').addEventListener('input', (e) => {
            document.getElementById('confValue').textContent = parseFloat(e.target.value).toFixed(2);
        });

        document.getElementById('scale').addEventListener('input', (e) => {
            document.getElementById('scaleValue').textContent = parseFloat(e.target.value).toFixed(2);
        });

        // ç”Ÿæˆ3Dæ¨¡å‹
        document.getElementById('generateBtn').addEventListener('click', async () => {
            if (!currentFilename) {
                showStatus('error', 'âŒ è¯·å…ˆä¸Šä¼ å›¾åƒ');
                return;
            }

            showStatus('loading', '<span class="spinner"></span>æ­£åœ¨ç”Ÿæˆ3Dæ¨¡å‹ï¼Œè¯·è€å¿ƒç­‰å¾…...');
            document.getElementById('generateBtn').disabled = true;

            try {
                const straighten = document.getElementById('straighten').checked;
                const response = await fetch(`${API_BASE}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        filename: currentFilename,
                        confidence: parseFloat(document.getElementById('confidence').value),
                        scale: parseFloat(document.getElementById('scale').value),
                        straighten: straighten  // æ·»åŠ æ‹‰ç›´å‚æ•°
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    const mode = straighten ? 'âœ¨ å·²å¯ç”¨æ›¼å“ˆé¡¿å‡è®¾' : 'âš–ï¸ ä¿æŒåŸå§‹è½®å»“';
                    showStatus('success', `âœ… 3Dæ¨¡å‹ç”ŸæˆæˆåŠŸ! (${result.geometry_count} ä¸ªæˆ¿é—´, ${mode})`);

                    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                    const statsArea = document.getElementById('statsArea');
                    statsArea.style.display = 'block';
                    document.getElementById('geometryCount').textContent = result.geometry_count;
                    document.getElementById('modelWidth').textContent = result.size.width;
                    document.getElementById('modelDepth').textContent = result.size.depth;
                    document.getElementById('modelHeight').textContent = result.size.height;

                    // ä¸‹è½½é“¾æ¥
                    modelUrl = result.download_url;
                    document.getElementById('downloadBtn').onclick = () => {
                        window.location.href = modelUrl;
                    };

                    // åŠ è½½3Dæ¨¡å‹
                    load3DModel(modelUrl);
                } else {
                    showStatus('error', `âŒ ${result.message}`);
                }
            } catch (error) {
                showStatus('error', `âŒ ç”Ÿæˆå¤±è´¥: ${error.message}`);
            } finally {
                document.getElementById('generateBtn').disabled = false;
            }
        });

        // é‡ç½®
        document.getElementById('resetBtn').addEventListener('click', () => {
            currentFilename = null;
            currentModel = null;
            modelUrl = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('previewArea').className = 'preview-area empty';
            document.getElementById('previewArea').textContent = 'ä¸Šä¼ å›¾åƒåå°†æ˜¾ç¤ºé¢„è§ˆ';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('statsArea').style.display = 'none';
            document.getElementById('uploadStatus').classList.remove('show');
            document.getElementById('processStatus').classList.remove('show');
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–3DæŸ¥çœ‹å™¨
        window.addEventListener('load', () => {
            // ç­‰å¾…å¿…è¦çš„åº“åŠ è½½å®Œæˆ
            loadRequiredLibraries(() => {
                init3DViewer();
            });
        });

        // åŠ è½½å¿…è¦çš„åº“
        function loadRequiredLibraries(callback) {
            let loadedCount = 0;
            const totalScripts = 2;

            function onScriptLoaded() {
                loadedCount++;
                if (loadedCount === totalScripts) {
                    console.log('âœ… æ‰€æœ‰åº“åŠ è½½å®Œæˆ');
                    callback();
                }
            }

            // å¼•å…¥OrbitControls
            const script1 = document.createElement('script');
            script1.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.js';
            script1.onload = onScriptLoaded;
            script1.onerror = () => {
                console.error('âŒ OrbitControls åŠ è½½å¤±è´¥');
                onScriptLoaded(); // ç»§ç»­åŠ è½½
            };
            document.head.appendChild(script1);

            // å¼•å…¥GLTFLoader
            const script2 = document.createElement('script');
            script2.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/GLTFLoader.js';
            script2.onload = onScriptLoaded;
            script2.onerror = () => {
                console.error('âŒ GLTFLoader åŠ è½½å¤±è´¥');
                onScriptLoaded(); // ç»§ç»­åŠ è½½
            };
            document.head.appendChild(script2);
        }
    </script>
</body>
</html>
